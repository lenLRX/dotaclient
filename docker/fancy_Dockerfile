# docker build -t dotabot . --build-arg pwd=XXX --build-arg guard=XXX
FROM ubuntu:16.04
MAINTAINER Tim Zaman <timbobel@gmail.com>

RUN apt-get -q update \
 && apt-get -y install lib32gcc1 curl locales software-properties-common binutils wget

# Set up locales.
RUN locale-gen en_US.UTF-8
ENV LANG en_US.UTF-8
ENV LANGUAGE en_US:en
ENV LC_ALL en_US.UTF-8

# Accept steam licence agreement.
RUN echo steam steam/question select "I AGREE" | debconf-set-selections \
 && echo steam steam/license note '' | debconf-set-selections

# Install steam.
RUN apt-add-repository multiverse \
 && dpkg --add-architecture i386 \
 && apt-get -q update

# Install 32-bit libraries
RUN apt-get install -qy \
      libc6:i386 \
      libgl1-mesa-dri:i386 \
      libgl1-mesa-glx:i386

# Install steam dependencies
RUN apt-get install -qy --no-install-recommends \
      curl \
      python-apt \
      sudo \
      xterm \
      xz-utils \
      zenity

# Install steamcmd.
RUN apt-get -q update \
 && apt-get -y install lib32gcc1 steamcmd
RUN ln -s /usr/games/steamcmd /bin

# Update steamcmd.
RUN steamcmd validate +quit

# Install DOTA2 (AppID 570)
ARG user=timbobel@hotmail.com
ARG pwd
ARG guard
RUN steamcmd +login ${user} ${pwd} ${guard} +app_update 570 validate +quit

WORKDIR /root

RUN curl --silent http://media.steampowered.com/client/runtime/steam-runtime-release_latest.tar.xz | tar -xJ
